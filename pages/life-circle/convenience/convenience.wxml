<!-- convenience.wxml - ä¾¿æ°‘æœåŠ¡ -->
<page-meta>
  <navigation-bar title="ç”Ÿæ´»åœˆ"></navigation-bar>
</page-meta>

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<view class="page-loader {{pageLoaded ? 'hidden' : ''}}">
  <view class="loader-spinner"></view>
  <text class="loader-text">åŠ è½½ä¸­...</text>
</view>

<!-- ç¦»çº¿çŠ¶æ€æç¤º -->
<view class="offline-tip" wx:if="{{offline}}">
  å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™
</view>

<!-- é¡¶éƒ¨çŠ¶æ€æ å ä½ -->
<view class="status-bar-placeholder"></view>

<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container" wx:if="{{pageLoaded}}">
  
  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
  
  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <view class="search-icon">ğŸ”</view>
      <input 
        class="search-input"
        placeholder="æœç´¢ä¾¿æ°‘æœåŠ¡"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <view 
        class="search-clear" 
        wx:if="{{searchKeyword}}"
        bindtap="onClearSearch"
      >
        âœ•
      </view>
    </view>
  </view>

  <!-- æœåŠ¡ç±»å‹åˆ‡æ¢ -->
  <view class="service-type-tabs">
    <scroll-view scroll-x="true" enable-flex="true" class="scroll-view-horizontal">
      <view 
        class="service-type-tab" 
        wx:for="[{value: 'all', label: 'å…¨éƒ¨'}, {value: 'payment', label: 'ç¼´è´¹'}, {value: 'express', label: 'å¿«é€’'}, {value: 'agriculture', label: 'å†œäº§å“'}, {value: 'housekeeping', label: 'å®¶æ”¿'}, {value: 'maintenance', label: 'ç»´ä¿®'}, {value: 'legal', label: 'æ³•å¾‹'}]" 
        wx:key="value"
        data-type="{{item.value}}"
        bindtap="switchServiceType"
        style="background-color: {{selectedServiceType === item.value ? 'var(--primary-color)' : 'var(--bg-tertiary)'}}; color: {{selectedServiceType === item.value ? 'white' : 'var(--text-primary)'}};"
      >
        {{item.label}}
      </view>
    </scroll-view>
  </view>
  
  <!-- ä¾¿æ°‘æœåŠ¡åˆ—è¡¨ -->
  <view class="card">
    <view class="section-title font-xl font-bold text-primary">ä¾¿æ°‘æœåŠ¡</view>
    <view class="service-list">
      <view 
        wx:for="{{filteredServices}}" 
        wx:key="id"
        class="service-item card aging-friendly"
      >
        <view class="service-icon">
          <image src="{{item.icon}}" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <view class="service-name font-lg font-bold text-primary">{{item.name}}</view>
          <view class="service-description font-sm text-secondary">{{item.description}}</view>
        </view>
        <view class="service-actions">
          <button 
            class="btn btn-primary font-lg"
            bindtap="viewServiceDetail"
            data-service-id="{{item.id}}"
            style="margin-right: 20rpx;"
          >
            è¯¦æƒ…
          </button>
          <button 
            class="btn btn-secondary font-lg"
            bindtap="openBookingModal"
            data-id="{{item.id}}"
          >
            é¢„çº¦
          </button>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{isLoading}}">
        <view class="load-more-spinner"></view>
        <text class="load-more-text">åŠ è½½ä¸­...</text>
      </view>
      
      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:if="{{!hasMore && filteredServices.length > 0}}">
        æ²¡æœ‰æ›´å¤šæœåŠ¡äº†
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{filteredServices.length === 0}}">
        <view class="empty-text font-lg text-secondary">æš‚æ— ç›¸å…³æœåŠ¡</view>
      </view>
    </view>
  </view>

  <!-- æœåŠ¡é¢„çº¦è®°å½• -->
  <view class="card">
    <view class="section-title font-xl font-bold text-primary">æœåŠ¡é¢„çº¦è®°å½•</view>
    <view class="booking-list">
      <view 
        wx:for="{{bookingRecords}}" 
        wx:key="id"
        class="booking-item card aging-friendly"
      >
        <view class="booking-service font-lg font-medium text-primary">{{item.serviceName}}</view>
        <view class="booking-time font-sm text-secondary">{{item.bookingTime}}</view>
        <view class="booking-status" style="color: {{item.status === 'completed' ? '#52c41a' : (item.status === 'pending' ? '#faad14' : '#f5222d')}};">
          {{item.status === 'completed' ? 'å·²å®Œæˆ' : (item.status === 'pending' ? 'å¾…å¤„ç†' : 'å·²å–æ¶ˆ')}}
        </view>
        <button 
          class="btn btn-primary font-lg"
          bindtap="viewBookingRecord"
          data-record-id="{{item.id}}"
        >
          æŸ¥çœ‹
        </button>
      </view>
      <view wx:if="{{bookingRecords.length === 0}}">
        <view class="empty-text font-lg text-secondary">æš‚æ— æœåŠ¡é¢„çº¦è®°å½•</view>
      </view>
    </view>
  </view>

  <!-- é¢„çº¦å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showBookingModal}}"></view>
  <view class="modal-container" wx:if="{{showBookingModal}}">
    <view class="modal-content">
      <view class="modal-title font-xl font-bold text-primary">ç¡®è®¤é¢„çº¦</view>
      <view class="modal-body">
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">æœåŠ¡åç§°</view>
          <view class="modal-item-value font-lg font-medium text-primary">{{selectedService.name}}</view>
        </view>
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">æœåŠ¡æè¿°</view>
          <view class="modal-item-value font-lg text-secondary">{{selectedService.description}}</view>
        </view>
      </view>
      <view class="modal-footer">
        <button 
          class="btn btn-secondary font-lg"
          bindtap="closeBookingModal"
          style="margin-right: 20rpx; flex: 1;"
        >
          å–æ¶ˆ
        </button>
        <button 
          class="btn btn-primary font-lg"
          bindtap="confirmBooking"
          style="flex: 1;"
        >
          ç¡®è®¤é¢„çº¦
        </button>
      </view>
    </view>
  </view>
  </view>
</view>