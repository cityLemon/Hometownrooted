<!--index.wxml-->
<page-meta>
  <navigation-bar title="ä¹¡æ‘å®‰åœŸ"></navigation-bar>
</page-meta>

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<view class="page-loader {{pageLoaded ? 'hidden' : ''}}">
  <view class="loader-spinner"></view>
  <text class="loader-text">åŠ è½½ä¸­...</text>
</view>

<!-- è°ƒè¯•ä¿¡æ¯é¢æ¿ -->
<view class="debug-panel {{debugInfo.showDebug ? '' : 'hidden'}}" wx:if="{{debugInfo.showDebug}}">
  <view class="debug-header">
    <text class="debug-title">ğŸ”§ è°ƒè¯•ä¿¡æ¯</text>
    <view class="debug-close" bindtap="toggleDebugInfo">âœ•</view>
  </view>
  
  <view class="debug-content">
    <!-- åç«¯è¿æ¥çŠ¶æ€ -->
    <view class="debug-item">
      <view class="debug-label">
        <text>ğŸ“¡ åç«¯è¿æ¥</text>
      </view>
      <view class="debug-status {{debugInfo.backendConnected ? 'success' : 'error'}}">
        <text>{{debugInfo.backendConnected ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}}</text>
      </view>
      <view class="debug-detail" wx:if="{{debugInfo.backendConnected}}">
        <text>åœ°å€: {{debugInfo.backendUrl}}</text>
      </view>
    </view>
    
    <!-- æ•°æ®åº“è¿æ¥çŠ¶æ€ -->
    <view class="debug-item">
      <view class="debug-label">
        <text>ğŸ’¾ æ•°æ®åº“è¿æ¥</text>
      </view>
      <view class="debug-status {{debugInfo.databaseConnected ? 'success' : 'error'}}">
        <text>{{debugInfo.databaseConnected ? 'âœ… å·²è¿æ¥' : 'âŒ æœªè¿æ¥'}}</text>
      </view>
      <view class="debug-detail" wx:if="{{debugInfo.databaseConnected}}">
        <text>ç±»å‹: {{debugInfo.databaseType}}</text>
        <text>åç§°: {{debugInfo.databaseName}}</text>
      </view>
    </view>
    
    <!-- é‡æ–°æ£€æŸ¥æŒ‰é’® -->
    <view class="debug-actions">
      <button class="debug-btn" bindtap="recheckConnections" size="mini">
        ğŸ”„ é‡æ–°æ£€æŸ¥
      </button>
      <button class="debug-btn" bindtap="toggleDebugInfo" size="mini">
        ğŸ‘ï¸ éšè—é¢æ¿
      </button>
    </view>
  </view>
</view>

<!-- è°ƒè¯•æŒ‰é’®ï¼ˆå½“é¢æ¿éšè—æ—¶æ˜¾ç¤ºï¼‰ -->
<view class="debug-toggle-btn" wx:if="{{!debugInfo.showDebug}}" bindtap="toggleDebugInfo">
  <text>ğŸ”§</text>
</view>

<!-- ç¦»çº¿çŠ¶æ€æç¤º -->
<view class="offline-tip" wx:if="{{offline}}">
  å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™
</view>

<!-- é¡¶éƒ¨çŠ¶æ€æ å ä½ -->
<view class="status-bar-placeholder"></view>

<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container" bindtap="onPageTap">
  <!-- è½®æ’­å›¾åŒºåŸŸ -->
  <view class="swiper-section">
    <view class="swiper-container">
      <!-- å·¦ç®­å¤´ -->
      <view class="swiper-arrow swiper-arrow-left" bindtap="prevSlide">
        <text class="arrow-icon">â€¹</text>
      </view>
      
      <!-- å³ç®­å¤´ -->
      <view class="swiper-arrow swiper-arrow-right" bindtap="nextSlide">
        <text class="arrow-icon">â€º</text>
      </view>
      
      <swiper 
        current="{{currentSwiperIndex}}"
        indicator-dots="{{true}}" 
        autoplay="{{true}}" 
        interval="3000" 
        duration="800"
        circular="{{true}}"
        class="swiper"
        indicator-active-color="#ffffff"
        indicator-color="rgba(255, 255, 255, 0.3)"
        bindchange="onSwiperChange"
      >
        <swiper-item 
          wx:for="{{swiperList}}" 
          wx:key="id"
          data-url="{{item.url}}"
          bindtap="swiperItemTap"
          class="swiper-item"
        >
          <image src="{{item.image}}" mode="aspectFill" class="swiper-image" lazy-load></image>
          <!-- æ¸å˜å åŠ å±‚ -->
          <view class="swiper-overlay"></view>
          <!-- è½®æ’­æ ‡é¢˜ï¼Œæ·»åŠ åŠ¨ç”» -->
          <view class="swiper-content">
            <view class="swiper-title fade-in-up">{{item.title}}</view>
          </view>
        </swiper-item>
      </swiper>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- è§’è‰²é€‰æ‹©åŒºåŸŸ -->
    <view class="section role-selection">
      <view class="section-header">
        <view class="section-title">è¯·é€‰æ‹©æ‚¨çš„è§’è‰²</view>
        <view class="section-subtitle">ä¸åŒè§’è‰²äº«æœ‰ä¸åŒåŠŸèƒ½ä¸æœåŠ¡</view>
      </view>
      <view class="role-list">
        <!-- ç¬¬ä¸€è¡Œï¼š2ä¸ªè§’è‰² -->
        <view class="role-row top">
          <view 
            wx:for="{{roles}}" 
            wx:for-item="role"
            wx:if="{{index < 2}}"
            wx:key="id"
            class="role-item {{selectedRole === role.id ? 'selected' : ''}}"
            data-role-id="{{role.id}}"
            bindtap="selectRole"
            data-index="{{index}}"
            animation="{{roleAnimations[index]}}"
          >
            <!-- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <view class="role-select-indicator" wx:if="{{selectedRole === role.id}}">
              <text class="select-icon">âœ“</text>
            </view>
            
            <!-- è§’è‰²å›¾æ ‡å®¹å™¨ -->
            <view class="role-icon-container">
              <view class="role-icon">
                <image src="{{role.icon}}" mode="aspectFit"></image>
              </view>
            </view>
            
            <!-- è§’è‰²ä¿¡æ¯ -->
            <view class="role-info">
              <view class="role-name">{{role.name}}</view>
              <view class="role-description">{{role.description}}</view>
            </view>
            
            <!-- è£…é¥°å…ƒç´  -->
            <view class="role-decoration"></view>
          </view>
        </view>
        
        <!-- ç¬¬äºŒè¡Œï¼š3ä¸ªè§’è‰² -->
        <view class="role-row bottom">
          <view 
            wx:for="{{roles}}" 
            wx:for-item="role"
            wx:if="{{index >= 2}}"
            wx:key="id"
            class="role-item {{selectedRole === role.id ? 'selected' : ''}}"
            data-role-id="{{role.id}}"
            bindtap="selectRole"
            data-index="{{index}}"
            animation="{{roleAnimations[index]}}"
          >
            <!-- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <view class="role-select-indicator" wx:if="{{selectedRole === role.id}}">
              <text class="select-icon">âœ“</text>
            </view>
            
            <!-- è§’è‰²å›¾æ ‡å®¹å™¨ -->
            <view class="role-icon-container">
              <view class="role-icon">
                <image src="{{role.icon}}" mode="aspectFit"></image>
              </view>
            </view>
            
            <!-- è§’è‰²ä¿¡æ¯ -->
            <view class="role-info">
              <view class="role-name">{{role.name}}</view>
              <view class="role-description">{{role.description}}</view>
            </view>
            
            <!-- è£…é¥°å…ƒç´  -->
            <view class="role-decoration"></view>
          </view>
        </view>
      </view>
      
      <!-- è¿›å…¥è§’è‰²æŒ‰é’® -->
      <view class="enter-role-btn-container">
        <button class="enter-role-btn" bindtap="enterRole" animation="{{enterButtonAnimation}}" disabled="{{!selectedRole}}">
          <text>{{selectedRole ? 'è¿›å…¥ ' + selectedRoleName : 'è¯·å…ˆé€‰æ‹©è§’è‰²'}}</text>
          <text class="arrow">â†’</text>
        </button>
      </view>
    </view>

    <!-- å¿«æ·å…¥å£åŒºåŸŸ -->
    <view class="section quick-entrance">
      <view class="section-header">
        <view class="section-title">å¿«æ·å…¥å£</view>
        <view class="section-subtitle">å¸¸ç”¨åŠŸèƒ½ä¸€é”®ç›´è¾¾</view>
      </view>
      <view class="quick-entrance-grid">
        <view 
          wx:for="{{quickEntrances}}" 
          wx:key="id"
          class="quick-entrance-item"
          data-url="{{item.url}}"
          bindtap="quickEntranceTap"
          animation="{{item.animation}}"
        >
          <view class="quick-entrance-icon">
            <image src="{{item.icon}}" mode="aspectFit"></image>
          </view>
          <view class="quick-entrance-name">{{item.name}}</view>
        </view>
        

      </view>
    </view>

    <!-- åº•éƒ¨ç•™ç™½ -->
    <view class="bottom-padding"></view>
  </view>
</view>

<!-- è¯­éŸ³å¯¼èˆªæŒ‰é’® -->
<view class="voice-nav-btn" bindtap="voiceNav">
  <text class="font-xl">ğŸ¤</text>
</view>

<!-- èƒŒæ™¯è£…é¥°å…ƒç´  -->
<view class="bg-decoration bg-decoration-1"></view>
<view class="bg-decoration bg-decoration-2"></view>
<view class="bg-decoration bg-decoration-3"></view>
<view class="dot-pattern"></view>
