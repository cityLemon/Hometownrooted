<!--index.wxml-->
<page-meta>
  <navigation-bar title="乡村安土"></navigation-bar>
</page-meta>

<!-- 页面加载动画 -->
<view class="page-loader {{pageLoaded ? 'hidden' : ''}}">
  <view class="loader-spinner"></view>
  <text class="loader-text">加载中...</text>
</view>

<!-- 离线状态提示 -->
<view class="offline-tip" wx:if="{{offline}}">
  当前处于离线状态，部分功能可能受限
</view>

<!-- 顶部状态栏占位 -->
<view class="status-bar-placeholder"></view>

<!-- 页面容器 -->
<view class="page-container" bindtap="onPageTap">
  <!-- 轮播图区域 -->
  <view class="swiper-section">
    <view class="swiper-container">
      <!-- 左箭头 -->
      <view class="swiper-arrow swiper-arrow-left" bindtap="prevSlide">
        <text class="arrow-icon">‹</text>
      </view>
      
      <!-- 右箭头 -->
      <view class="swiper-arrow swiper-arrow-right" bindtap="nextSlide">
        <text class="arrow-icon">›</text>
      </view>
      
      <swiper 
        current="{{currentSwiperIndex}}"
        indicator-dots="{{true}}" 
        autoplay="{{true}}" 
        interval="3000" 
        duration="800"
        circular="{{true}}"
        class="swiper"
        indicator-active-color="#ffffff"
        indicator-color="rgba(255, 255, 255, 0.3)"
        bindchange="onSwiperChange"
      >
        <swiper-item 
          wx:for="{{swiperList}}" 
          wx:key="id"
          data-url="{{item.url}}"
          bindtap="swiperItemTap"
          class="swiper-item"
        >
          <image src="{{item.image}}" mode="aspectFill" class="swiper-image" lazy-load></image>
          <!-- 渐变叠加层 -->
          <view class="swiper-overlay"></view>
          <!-- 轮播标题，添加动画 -->
          <view class="swiper-content">
            <view class="swiper-title fade-in-up">{{item.title}}</view>
          </view>
        </swiper-item>
      </swiper>
    </view>
  </view>

  <!-- 主要内容区域 -->
  <view class="main-content">
    <!-- 角色选择区域 -->
    <view class="section role-selection">
      <view class="section-header">
        <view class="section-title">请选择您的角色</view>
        <view class="section-subtitle">不同角色享有不同功能与服务</view>
      </view>
      <view class="role-list">
        <!-- 第一行：2个角色 -->
        <view class="role-row top">
          <view 
            wx:for="{{roles}}" 
            wx:for-item="role"
            wx:if="{{index < 2}}"
            wx:key="id"
            class="role-item {{selectedRole === role.id ? 'selected' : ''}}"
            data-role-id="{{role.id}}"
            bindtap="selectRole"
            data-index="{{index}}"
            animation="{{roleAnimations[index]}}"
          >
            <!-- 选中状态指示器 -->
            <view class="role-select-indicator" wx:if="{{selectedRole === role.id}}">
              <text class="select-icon">✓</text>
            </view>
            
            <!-- 角色图标容器 -->
            <view class="role-icon-container">
              <view class="role-icon">
                <image src="{{role.icon}}" mode="aspectFit"></image>
              </view>
            </view>
            
            <!-- 角色信息 -->
            <view class="role-info">
              <view class="role-name">{{role.name}}</view>
              <view class="role-description">{{role.description}}</view>
            </view>
            
            <!-- 装饰元素 -->
            <view class="role-decoration"></view>
          </view>
        </view>
        
        <!-- 第二行：3个角色 -->
        <view class="role-row bottom">
          <view 
            wx:for="{{roles}}" 
            wx:for-item="role"
            wx:if="{{index >= 2}}"
            wx:key="id"
            class="role-item {{selectedRole === role.id ? 'selected' : ''}}"
            data-role-id="{{role.id}}"
            bindtap="selectRole"
            data-index="{{index}}"
            animation="{{roleAnimations[index]}}"
          >
            <!-- 选中状态指示器 -->
            <view class="role-select-indicator" wx:if="{{selectedRole === role.id}}">
              <text class="select-icon">✓</text>
            </view>
            
            <!-- 角色图标容器 -->
            <view class="role-icon-container">
              <view class="role-icon">
                <image src="{{role.icon}}" mode="aspectFit"></image>
              </view>
            </view>
            
            <!-- 角色信息 -->
            <view class="role-info">
              <view class="role-name">{{role.name}}</view>
              <view class="role-description">{{role.description}}</view>
            </view>
            
            <!-- 装饰元素 -->
            <view class="role-decoration"></view>
          </view>
        </view>
      </view>
      
      <!-- 进入角色按钮 -->
      <view class="enter-role-btn-container">
        <button class="enter-role-btn" bindtap="enterRole" animation="{{enterButtonAnimation}}" disabled="{{!selectedRole}}">
          <text>{{selectedRole ? '进入 ' + selectedRoleName : '请先选择角色'}}</text>
          <text class="arrow">→</text>
        </button>
      </view>
    </view>

    <!-- 快捷入口区域 -->
    <view class="section quick-entrance">
      <view class="section-header">
        <view class="section-title">快捷入口</view>
        <view class="section-subtitle">常用功能一键直达</view>
      </view>
      <view class="quick-entrance-grid">
        <view 
          wx:for="{{quickEntrances}}" 
          wx:key="id"
          class="quick-entrance-item"
          data-url="{{item.url}}"
          bindtap="quickEntranceTap"
          animation="{{item.animation}}"
        >
          <view class="quick-entrance-icon">
            <image src="{{item.icon}}" mode="aspectFit"></image>
          </view>
          <view class="quick-entrance-name">{{item.name}}</view>
        </view>
        

      </view>
    </view>

    <!-- 底部留白 -->
    <view class="bottom-padding"></view>
  </view>
</view>

<!-- 语音导航按钮 -->
<view class="voice-nav-btn" bindtap="voiceNav">
  <text class="font-xl">🎤</text>
</view>

<!-- 背景装饰元素 -->
<view class="bg-decoration bg-decoration-1"></view>
<view class="bg-decoration bg-decoration-2"></view>
<view class="bg-decoration bg-decoration-3"></view>
<view class="dot-pattern"></view>
