<!-- service-manage.wxml - 服务管理 -->
<page-meta>
  <navigation-bar title="服务管理"></navigation-bar>
</page-meta>

<view class="page-content">
  <!-- 筛选区域 -->
  <view class="filter-section">
    <!-- 状态筛选 -->
    <view class="filter-tabs">
      <view 
        class="filter-tab" 
        wx:for="[{value: 'all', label: '全部'}, {value: 'pending', label: '待处理'}, {value: 'processing', label: '处理中'}, {value: 'completed', label: '已完成'}, {value: 'cancelled', label: '已取消'}]" 
        wx:key="value"
        data-status="{{item.value}}"
        bindtap="switchFilterStatus"
        style="background-color: {{filterStatus === item.value ? 'var(--primary-color)' : 'var(--bg-tertiary)'}}; color: {{filterStatus === item.value ? 'white' : 'var(--text-primary)'}};"
      >
        {{item.label}}
      </view>
    </view>
    
    <!-- 服务类型筛选 -->
    <view class="service-type-filter">
      <view class="filter-label font-lg font-medium text-primary">服务类型：</view>
      <view class="service-type-tabs">
        <scroll-view scroll-x="true" enable-flex="true" class="scroll-view-horizontal">
          <view 
            class="service-type-tab" 
            wx:for="{{serviceTypes}}" 
            wx:key="index"
            data-type="{{item}}"
            bindtap="switchServiceType"
            style="background-color: {{selectedServiceType === item ? 'var(--primary-color)' : 'var(--bg-tertiary)'}}; color: {{selectedServiceType === item ? 'white' : 'var(--text-primary)'}};"
          >
            {{item}}
          </view>
        </scroll-view>
      </view>
    </view>
    
    <!-- 导出数据按钮 -->
    <view class="export-button-container">
      <button 
        class="btn btn-primary font-lg"
        bindtap="exportOrderData"
      >
        导出数据
      </button>
    </view>
  </view>
  
  <!-- 服务预约列表 -->
  <view class="section-title font-xl font-bold text-primary">服务预约列表</view>
  <view class="booking-list">
    <view 
      wx:for="{{filteredServiceBookings}}" 
      wx:key="id"
      class="booking-item aging-friendly"
    >
      <view class="booking-header">
        <view class="booking-id font-sm text-secondary">订单ID：{{item.id}}</view>
        <view class="booking-status" style="color: {{item.status === 'pending' ? '#faad14' : (item.status === 'processing' ? '#1890ff' : (item.status === 'completed' ? '#52c41a' : '#f5222d'))}};">
          {{item.status === 'pending' ? '待处理' : (item.status === 'processing' ? '处理中' : (item.status === 'completed' ? '已完成' : '已取消'))}}
        </view>
      </view>
      <view class="booking-content">
        <view class="booking-service font-lg font-bold text-primary">{{item.serviceName}}</view>
        <view class="booking-user-info font-sm text-secondary">
          {{item.userName}} | {{item.userPhone}}
        </view>
        <view class="booking-time font-sm text-secondary">
          预约时间：{{item.bookingTime}}
        </view>
        <view class="booking-amount font-lg font-bold text-primary" wx:if="{{item.amount}}">
          金额：¥{{item.amount}}
        </view>
        <view class="booking-tracking" wx:if="{{item.trackingNumber}}">
          <view class="tracking-label font-sm text-secondary">快递单号：</view>
          <view class="tracking-number font-sm font-medium text-primary">{{item.trackingNumber}}</view>
        </view>
      </view>
      <view class="booking-actions">
        <button 
          class="btn btn-primary font-lg"
          bindtap="viewOrderDetail"
          data-order-id="{{item.id}}"
          style="margin-bottom: 20rpx;"
        >
          查看详情
        </button>
        <!-- 状态更新按钮 -->
        <view class="status-update-buttons" wx:if="{{item.status === 'pending'}}">
          <button 
            class="btn btn-secondary font-lg"
            bindtap="updateOrderStatus"
            data-order-id="{{item.id}}"
            data-status="processing"
            style="margin-bottom: 20rpx;"
          >
            开始处理
          </button>
          <button 
            class="btn btn-danger font-lg"
            bindtap="updateOrderStatus"
            data-order-id="{{item.id}}"
            data-status="cancelled"
          >
            取消订单
          </button>
        </view>
        <view class="status-update-buttons" wx:if="{{item.status === 'processing'}}">
          <button 
            class="btn btn-success font-lg"
            bindtap="updateOrderStatus"
            data-order-id="{{item.id}}"
            data-status="completed"
            style="margin-bottom: 20rpx;"
          >
            完成订单
          </button>
          <button 
            class="btn btn-danger font-lg"
            bindtap="updateOrderStatus"
            data-order-id="{{item.id}}"
            data-status="cancelled"
          >
            取消订单
          </button>
        </view>
      </view>
    </view>
    <view wx:if="{{filteredServiceBookings.length === 0}}">
      <view class="empty-text font-lg text-secondary">暂无服务预约记录</view>
    </view>
  </view>
</view>
