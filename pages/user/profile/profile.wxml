<!-- profile.wxml - ä¸ªäººä¿¡æ¯ -->
<page-meta>
  <navigation-bar title="æˆ‘çš„"></navigation-bar>
</page-meta>

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<view class="page-loader {{pageLoaded ? 'hidden' : ''}}">
  <view class="loader-spinner"></view>
  <text class="loader-text">åŠ è½½ä¸­...</text>
</view>

<!-- ç¦»çº¿çŠ¶æ€æç¤º -->
<view class="offline-tip" wx:if="{{offline}}">
  å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™
</view>

<!-- é¡¶éƒ¨çŠ¶æ€æ å ä½ -->
<view class="status-bar-placeholder"></view>

<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container" wx:if="{{pageLoaded}}">
  
  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-prompt" wx:if="{{!isLoggedIn}}">
    <view class="login-icon">ğŸ”’</view>
    <view class="login-title font-xl font-bold text-primary">è¯·ç™»å½•</view>
    <view class="login-desc font-lg text-secondary">ç™»å½•åå¯æŸ¥çœ‹ä¸ªäººä¿¡æ¯</view>
    <button 
      class="btn btn-primary btn-large font-lg font-bold login-btn"
      bindtap="goToLogin"
    >
      ç«‹å³ç™»å½•
    </button>
  </view>
  
  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view class="page-content" wx:else>
  <!-- ç¼–è¾‘æ¨¡å¼æŒ‰é’® -->
  <view class="edit-mode-buttons" wx:if="{{!editMode}}">
    <button 
      class="btn btn-primary btn-large font-lg font-bold"
      bindtap="enterEditMode"
    >
      ç¼–è¾‘ä¿¡æ¯
    </button>
  </view>

  <!-- ä¿å­˜/å–æ¶ˆæŒ‰é’® -->
  <view class="save-cancel-buttons" wx:if="{{editMode}}">
    <button 
      class="btn btn-primary btn-large font-lg font-bold"
      bindtap="saveEdit"
      style="margin-right: 20rpx; flex: 1;"
    >
      ä¿å­˜
    </button>
    <button 
      class="btn btn-secondary btn-large font-lg font-bold"
      bindtap="cancelEdit"
      style="flex: 1;"
    >
      å–æ¶ˆ
    </button>
  </view>

  <!-- ç”¨æˆ·å¤´åƒ -->
  <view class="avatar-section">
    <view class="avatar-container" bindtap="chooseAvatar">
      <image src="{{editMode ? tempUserInfo.avatarUrl : userInfo.avatarUrl}}" mode="aspectFit" class="avatar"></image>
      <view class="avatar-hint font-lg text-secondary">
        {{editMode ? 'ç‚¹å‡»æ›´æ¢å¤´åƒ' : 'ç‚¹å‡»æŸ¥çœ‹å¤´åƒ'}}
      </view>
    </view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="card">
    <view class="section-title font-xl font-bold text-primary">åŸºæœ¬ä¿¡æ¯</view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">å§“å</view>
      <view class="form-value" wx:if="{{!editMode}}">{{userInfo.name}}</view>
      <input 
        wx:else 
        class="form-input font-lg"
        value="{{tempUserInfo.name}}"
        placeholder="è¯·è¾“å…¥å§“å"
        data-field="name"
        bindinput="inputChange"
      />
    </view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">ç”µè¯</view>
      <view class="form-value" wx:if="{{!editMode}}">{{userInfo.phone}}</view>
      <input 
        wx:else 
        class="form-input font-lg"
        value="{{tempUserInfo.phone}}"
        placeholder="è¯·è¾“å…¥ç”µè¯"
        type="number"
        data-field="phone"
        bindinput="inputChange"
      />
    </view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">æ€§åˆ«</view>
      <view class="form-value" wx:if="{{!editMode}}">{{userInfo.gender}}</view>
      <input 
        wx:else 
        class="form-input font-lg"
        value="{{tempUserInfo.gender}}"
        placeholder="è¯·è¾“å…¥æ€§åˆ«"
        data-field="gender"
        bindinput="inputChange"
      />
    </view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">å¹´é¾„</view>
      <view class="form-value" wx:if="{{!editMode}}">{{userInfo.age}}</view>
      <input 
        wx:else 
        class="form-input font-lg"
        value="{{tempUserInfo.age}}"
        placeholder="è¯·è¾“å…¥å¹´é¾„"
        type="number"
        data-field="age"
        bindinput="inputChange"
      />
    </view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">åœ°å€</view>
      <view class="form-value" wx:if="{{!editMode}}">{{userInfo.address}}</view>
      <input 
        wx:else 
        class="form-input font-lg"
        value="{{tempUserInfo.address}}"
        placeholder="è¯·è¾“å…¥åœ°å€"
        data-field="address"
        bindinput="inputChange"
      />
    </view>
    <view class="form-item">
      <view class="form-label font-lg font-medium text-primary">è§’è‰²</view>
      <view class="form-value" wx:if="{{!editMode}}">
        {{userInfo.role === 'elder' ? 'è€äºº' : (userInfo.role === 'volunteer' ? 'å¿—æ„¿è€…' : (userInfo.role === 'admin' ? 'ç®¡ç†å‘˜' : (userInfo.role === 'government' ? 'æ”¿åºœäººå‘˜' : 'ä¼ä¸šCSR')))}}
      </view>
      <view class="form-value" wx:else>
        {{userInfo.role === 'elder' ? 'è€äºº' : (userInfo.role === 'volunteer' ? 'å¿—æ„¿è€…' : (userInfo.role === 'admin' ? 'ç®¡ç†å‘˜' : (userInfo.role === 'government' ? 'æ”¿åºœäººå‘˜' : 'ä¼ä¸šCSR')))}}
      </view>
    </view>
  </view>

  <!-- å®¶åº­æˆå‘˜ -->
  <view class="card">
    <view class="section-title font-xl font-bold text-primary">å®¶åº­æˆå‘˜</view>
    <view wx:if="{{userInfo.familyMembers.length === 0}}">
      <view class="empty-text font-lg text-secondary">æš‚æ— å®¶åº­æˆå‘˜</view>
    </view>
    <view wx:else>
      <view wx:for="{{userInfo.familyMembers}}" wx:key="id" class="family-member-item card aging-friendly">
        <view class="family-member-info">
          <view class="family-member-name font-lg font-medium text-primary">{{item.name}}</view>
          <view class="family-member-relation font-sm text-secondary">{{item.relation}}</view>
          <view class="family-member-phone font-sm text-secondary">{{item.phone}}</view>
        </view>
      </view>
    </view>
    <button 
      class="btn btn-secondary font-lg"
      bindtap="viewFamilyLinkage"
      style="margin-top: 20rpx;"
    >
      ç®¡ç†å®¶åº­æˆå‘˜
    </button>
  </view>

  <!-- è´¦æˆ·è®¾ç½® -->
  <view class="card">
    <view class="section-title font-xl font-bold text-primary">è´¦æˆ·è®¾ç½®</view>
    <view class="setting-item card aging-friendly" bindtap="viewRoleSwitch">
      <view class="setting-icon">ğŸ”„</view>
      <view class="setting-info">
        <view class="setting-name font-lg font-medium text-primary">è§’è‰²åˆ‡æ¢</view>
        <view class="setting-desc font-sm text-secondary">åˆ‡æ¢ä¸åŒè§’è‰²è§†å›¾</view>
      </view>
      <view class="setting-arrow">â†’</view>
    </view>
    <view class="setting-item card aging-friendly" bindtap="logout">
      <view class="setting-icon">ğŸšª</view>
      <view class="setting-info">
        <view class="setting-name font-lg font-medium text-primary">é€€å‡ºç™»å½•</view>
        <view class="setting-desc font-sm text-secondary">å®‰å…¨é€€å‡ºå½“å‰è´¦å·</view>
      </view>
      <view class="setting-arrow">â†’</view>
    </view>
  </view>
  </view>
</view>
