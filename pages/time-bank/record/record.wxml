<!-- record.wxml - æœåŠ¡è®°å½•ä¸å…‘æ¢ -->
<page-meta>
  <navigation-bar title="æ—¶é—´é“¶è¡Œ"></navigation-bar>
</page-meta>

<!-- é¡µé¢åŠ è½½åŠ¨ç”» -->
<view class="page-loader {{pageLoaded ? 'hidden' : ''}}">
  <view class="loader-spinner"></view>
  <text class="loader-text">åŠ è½½ä¸­...</text>
</view>

<!-- ç¦»çº¿çŠ¶æ€æç¤º -->
<view class="offline-tip" wx:if="{{offline}}">
  å½“å‰å¤„äºç¦»çº¿çŠ¶æ€ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½å—é™
</view>

<!-- é¡¶éƒ¨çŠ¶æ€æ å ä½ -->
<view class="status-bar-placeholder"></view>

<!-- é¡µé¢å®¹å™¨ -->
<view class="page-container" wx:if="{{pageLoaded}}">
  
  <!-- é¡µé¢å†…å®¹ -->
  <view class="page-content">
  <!-- æ—¶é—´å¸ä½™é¢ -->
  <view class="card balance-card">
    <view class="balance-title font-xl font-bold text-primary">æˆ‘çš„æ—¶é—´å¸</view>
    <view class="balance-content">
      <view class="balance-number font-2xl font-bold text-primary">{{timeCoinBalance}}</view>
      <view class="balance-unit font-lg text-secondary">æ—¶é—´å¸</view>
    </view>
    <view class="balance-hint font-lg text-secondary">
      æ¯1å°æ—¶å¿—æ„¿æœåŠ¡å¯è·å¾—1æ—¶é—´å¸
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <view class="search-icon">ğŸ”</view>
      <input 
        class="search-input"
        placeholder="æœç´¢æœåŠ¡è®°å½•"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
      <view 
        class="search-clear" 
        wx:if="{{searchKeyword}}"
        bindtap="onClearSearch"
      >
        âœ•
      </view>
    </view>
  </view>

  <!-- æœåŠ¡è®°å½• -->
  <view class="section-title font-xl font-bold text-primary">æœåŠ¡è®°å½•</view>
  
  <!-- è®°å½•ç±»å‹åˆ‡æ¢ -->
  <view class="record-type-tabs">
    <view 
      class="record-type-tab" 
      wx:for="[{value: 'all', label: 'å…¨éƒ¨'}, {value: 'earn', label: 'èµšå–'}, {value: 'spend', label: 'æ¶ˆè´¹'}]" 
      wx:key="value"
      data-type="{{item.value}}"
      bindtap="switchRecordType"
      style="background-color: {{selectedRecordType === item.value ? 'var(--primary-color)' : 'var(--bg-tertiary)'}}; color: {{selectedRecordType === item.value ? 'white' : 'var(--text-primary)'}};"
    >
      {{item.label}}
    </view>
  </view>
  
  <!-- æœåŠ¡è®°å½•åˆ—è¡¨ -->
  <view class="record-list">
    <view 
      wx:for="{{filteredServiceRecords}}" 
      wx:key="id"
      class="record-item aging-friendly"
    >
      <view class="record-type-icon" style="color: {{item.type === 'earn' ? '#52c41a' : '#f5222d'}};">
        {{item.type === 'earn' ? '+' : '-'}}{{item.duration}}
      </view>
      <view class="record-info">
        <view class="record-title font-lg font-medium text-primary">{{item.title}}</view>
        <view class="record-time font-sm text-secondary">{{item.time}}</view>
        <view class="record-status" style="color: {{item.status === 'completed' ? '#52c41a' : '#faad14'}};">
          {{item.status === 'completed' ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}
        </view>
      </view>
      <button 
        class="btn btn-primary font-lg"
        bindtap="viewServiceDetail"
        data-record-id="{{item.id}}"
        style="margin-left: 20rpx;"
      >
        è¯¦æƒ…
      </button>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{isLoading}}">
      <view class="load-more-spinner"></view>
      <text class="load-more-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && filteredServiceRecords.length > 0}}">
      æ²¡æœ‰æ›´å¤šè®°å½•äº†
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{filteredServiceRecords.length === 0}}">
      <view class="empty-text font-lg text-secondary">æš‚æ— æœåŠ¡è®°å½•</view>
    </view>
  </view>

  <!-- å…‘æ¢è§„åˆ™ -->
  <view class="section-title font-xl font-bold text-primary">å…‘æ¢è§„åˆ™</view>
  <view class="exchange-rules-grid">
    <view 
      wx:for="{{exchangeRules}}" 
      wx:key="id"
      class="exchange-rule-card aging-friendly"
      bindtap="openExchangeModal"
      data-id="{{item.id}}"
    >
      <view class="exchange-rule-image">
        <image src="{{item.image}}" mode="aspectFit"></image>
      </view>
      <view class="exchange-rule-info">
        <view class="exchange-rule-name font-lg font-medium text-primary">{{item.name}}</view>
        <view class="exchange-rule-description font-sm text-secondary">{{item.description}}</view>
        <view class="exchange-rule-required font-lg font-bold text-primary" style="color: var(--error-color);">
          {{item.requiredTime}} æ—¶é—´å¸
        </view>
      </view>
      <button 
        class="btn btn-primary font-lg"
        bindtap="openExchangeModal"
        data-id="{{item.id}}"
      >
        å…‘æ¢
      </button>
    </view>
  </view>

  <!-- å¯¼å‡ºæŒ‰é’® -->
  <view class="export-section">
    <button 
      class="btn btn-secondary btn-large font-lg"
      bindtap="exportData"
    >
      å¯¼å‡ºæ•°æ®
    </button>
  </view>

  <!-- å…‘æ¢å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showExchangeModal}}"></view>
  <view class="modal-container" wx:if="{{showExchangeModal}}">
    <view class="modal-content">
      <view class="modal-title font-xl font-bold text-primary">ç¡®è®¤å…‘æ¢</view>
      <view class="modal-body">
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">å•†å“åç§°</view>
          <view class="modal-item-value font-lg font-medium text-primary">{{selectedExchangeItem.name}}</view>
        </view>
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">æ‰€éœ€æ—¶é—´å¸</view>
          <view class="modal-item-value font-lg font-bold text-error">{{selectedExchangeItem.requiredTime}} æ—¶é—´å¸</view>
        </view>
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">å½“å‰ä½™é¢</view>
          <view class="modal-item-value font-lg font-bold text-primary">{{timeCoinBalance}} æ—¶é—´å¸</view>
        </view>
        <view class="modal-item">
          <view class="modal-item-label font-lg text-primary">å…‘æ¢è¯´æ˜</view>
          <view class="modal-item-value font-lg text-secondary">{{selectedExchangeItem.description}}</view>
        </view>
      </view>
      <view class="modal-footer">
        <button 
          class="btn btn-secondary font-lg"
          bindtap="closeExchangeModal"
          style="margin-right: 20rpx; flex: 1;"
        >
          å–æ¶ˆ
        </button>
        <button 
          class="btn btn-primary font-lg"
          bindtap="confirmExchange"
          style="flex: 1;"
        >
          ç¡®è®¤å…‘æ¢
        </button>
      </view>
    </view>
  </view>
  </view>
</view>