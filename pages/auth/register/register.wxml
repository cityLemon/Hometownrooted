<!--pages/auth/register/register.wxml-->
<view class="auth-container">
  <view class="auth-header">
    <image class="logo" src="/images/roles/elder.svg" mode="aspectFit"></image>
    <text class="app-title">注册账号</text>
    <text class="app-subtitle">加入乡村安土，开启智慧乡村生活</text>
  </view>

  <view class="auth-form">
    <!-- 角色选择 -->
    <view class="form-item">
      <text class="label">选择角色</text>
      <view class="role-selector">
        <view 
          class="role-item {{selectedRole === 'elder' ? 'selected' : ''}}" 
          bindtap="selectRole" 
          data-role="elder"
        >
          <image class="role-icon" src="/images/roles/elder.svg"></image>
          <text class="role-name">老人</text>
        </view>
        <view 
          class="role-item {{selectedRole === 'volunteer' ? 'selected' : ''}}" 
          bindtap="selectRole" 
          data-role="volunteer"
        >
          <image class="role-icon" src="/images/roles/volunteer.svg"></image>
          <text class="role-name">志愿者</text>
        </view>
        <view 
          class="role-item {{selectedRole === 'admin' ? 'selected' : ''}}" 
          bindtap="selectRole" 
          data-role="admin"
        >
          <image class="role-icon" src="/images/roles/admin.svg"></image>
          <text class="role-name">管理员</text>
        </view>
        <view 
          class="role-item {{selectedRole === 'government' ? 'selected' : ''}}" 
          bindtap="selectRole" 
          data-role="government"
        >
          <image class="role-icon" src="/images/roles/government.svg"></image>
          <text class="role-name">政府人员</text>
        </view>
        <view 
          class="role-item {{selectedRole === 'csr' ? 'selected' : ''}}" 
          bindtap="selectRole" 
          data-role="csr"
        >
          <image class="role-icon" src="/images/roles/csr.svg"></image>
          <text class="role-name">企业CSR</text>
        </view>
      </view>
    </view>

    <!-- 基本信息 -->
    <view class="form-item">
      <text class="label">用户名</text>
      <input 
        class="input {{!validation.username.valid ? 'error' : ''}}" 
        placeholder="请输入用户名（3-20位）" 
        value="{{username}}"
        bindinput="onUsernameInput"
        maxlength="20"
      />
      <text class="error-message" wx:if="{{!validation.username.valid}}">{{validation.username.message}}</text>
    </view>

    <view class="form-item">
      <text class="label">真实姓名</text>
      <input 
        class="input" 
        placeholder="请输入真实姓名" 
        value="{{realName}}"
        bindinput="onRealNameInput"
        maxlength="20"
      />
    </view>

    <view class="form-item">
      <text class="label">手机号</text>
      <input 
        class="input {{!validation.phone.valid ? 'error' : ''}}" 
        placeholder="请输入手机号" 
        value="{{phone}}"
        bindinput="onPhoneInput"
        type="number"
        maxlength="11"
      />
      <text class="error-message" wx:if="{{!validation.phone.valid}}">{{validation.phone.message}}</text>
    </view>

    <view class="form-item">
      <text class="label">密码</text>
      <view class="password-input">
        <input 
          class="input {{!validation.password.valid ? 'error' : ''}}" 
          placeholder="请输入密码（6-20位）" 
          password="{{!showPassword}}"
          value="{{password}}"
          bindinput="onPasswordInput"
          maxlength="20"
        />
        <image 
          class="eye-icon" 
          src="{{showPassword ? '/images/eye-open.svg' : '/images/eye-close.svg'}}"
          bindtap="togglePassword"
        ></image>
      </view>
      <text class="error-message" wx:if="{{!validation.password.valid}}">{{validation.password.message}}</text>
      
      <!-- 密码强度指示器 -->
      <view class="password-strength" wx:if="{{password && passwordStrength > 0}}">
        <view class="strength-bar">
          <view class="strength-fill" style="width: {{(passwordStrength/5)*100}}%; background-color: {{passwordStrengthColor}}"></view>
        </view>
        <text class="strength-text" style="color: {{passwordStrengthColor}}">{{passwordStrengthText}}</text>
      </view>
    </view>

    <view class="form-item">
      <text class="label">确认密码</text>
      <view class="password-input">
        <input 
          class="input {{!validation.confirmPassword.valid ? 'error' : ''}}" 
          placeholder="请再次输入密码" 
          password="{{!showConfirmPassword}}"
          value="{{confirmPassword}}"
          bindinput="onConfirmPasswordInput"
          maxlength="20"
        />
        <image 
          class="eye-icon" 
          src="{{showConfirmPassword ? '/images/eye-open.svg' : '/images/eye-close.svg'}}"
          bindtap="toggleConfirmPassword"
        ></image>
      </view>
      <text class="error-message" wx:if="{{!validation.confirmPassword.valid}}">{{validation.confirmPassword.message}}</text>
    </view>

    <!-- 详细信息 -->
    <view class="form-row">
      <view class="form-item half">
        <text class="label">性别</text>
        <picker 
          class="picker" 
          bindchange="onGenderChange" 
          value="{{genderIndex}}" 
          range="{{genderOptions}}"
        >
          <view class="picker-content">
            <text class="{{genderIndex === -1 ? 'placeholder' : ''}}">
              {{genderIndex === -1 ? '请选择性别' : genderOptions[genderIndex]}}
            </text>
            <text class="picker-arrow">▼</text>
          </view>
        </picker>
      </view>

      <view class="form-item half">
        <text class="label">年龄</text>
        <input 
          class="input {{!validation.age.valid ? 'error' : ''}}" 
          placeholder="年龄" 
          value="{{age}}"
          bindinput="onAgeInput"
          type="number"
          maxlength="3"
        />
        <text class="error-message" wx:if="{{!validation.age.valid}}">{{validation.age.message}}</text>
      </view>
    </view>

    <view class="form-item">
      <text class="label">地址</text>
      <input 
        class="input" 
        placeholder="请输入详细地址" 
        value="{{address}}"
        bindinput="onAddressInput"
        maxlength="200"
      />
    </view>

    <!-- 协议同意 -->
    <view class="agreement-section">
      <checkbox-group bindchange="onAgreementChange">
        <label class="agreement-label">
          <checkbox value="1" checked="{{agreementChecked}}"/>
          <text>我已阅读并同意</text>
          <text class="agreement-link" bindtap="showServiceAgreement">《服务协议》</text>
          <text>和</text>
          <text class="agreement-link" bindtap="showPrivacyPolicy">《隐私政策》</text>
        </label>
      </checkbox-group>
    </view>

    <button class="register-btn" bindtap="onRegister" loading="{{isLoading}}" disabled="{{!isFormValid || isLoading}}">
      {{isLoading ? '注册中...' : '注册'}}
    </button>

    <view class="login-section">
      <text>已有账号？</text>
      <text class="login-link" bindtap="onLogin">立即登录</text>
    </view>
  </view>

  <!-- 页面加载动画 -->
  <view class="page-loader {{isLoading ? '' : 'hidden'}}">
    <view class="loader-spinner"></view>
    <text class="loader-text">正在注册...</text>
  </view>
</view>